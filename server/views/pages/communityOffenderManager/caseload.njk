{% extends "layout.njk" %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "./inactiveApplicationsTab.njk" import inactiveApplicationsTab %}
{% from "partials/caseload/caseloadTable.njk" import caseloadTable %}

{% set pageTitle = applicationName + " - Assessing a licence - Caseload" %}
{% set offenders = [] %}

{% macro offenderName(case, index) %}
    <div class="caseload-offender-name">
        <a id="name-button-{{ index }}" href="{{ case.createLink }}" class="govuk-link govuk-heading-s govuk-!-padding-left-0 govuk-!-margin-bottom-0">{{ case.name }}</a>
        <div class="govuk-hint govuk-!-font-size-16">CRN: {{ case.crn }}</div>
    </div>
{% endmacro %}

{% set cases = [] %}
{% for case in caseload %}
    {% set cases = (cases.push([
        {
            attributes: tableAttributes(case, 'name', loop.index),
            html: offenderName(case, loop.index)
        },
        {
            attributes: tableAttributes(case, 'pom', loop.index),
            text: ''
        },
        {
            attributes: tableAttributes(case, 'hdced', loop.index),
            html: case.hdced | formatDate('dd MMM yyyy')
        },
        {
            attributes: tableAttributes(case, 'workingDaysToHdced', loop.index),
            text: case.workingDaysToHdced
        },
        {
            attributes: tableAttributes(case, 'lastWorkedOnBy', loop.index),
            text: ''
        },
        {
            attributes: tableAttributes(case, 'task', loop.index),
            text: case.currentTask
        }
    ]), cases) %}
{% endfor %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            <h1 class="govuk-heading-l">Select someone's HDC application to work on</h1>
            <nav class="moj-sub-navigation" aria-label="Sub navigation">
                <ul class="moj-sub-navigation__list">
                    <li class="moj-sub-navigation__item">
                        <a class="moj-sub-navigation__link" {% if activeApplicationView %}aria-current="page"{% endif %} href="?view=active-applications">Active applications</a>
                    </li>
                    <li class="moj-sub-navigation__item">
                        <a class="moj-sub-navigation__link" {% if not activeApplicationView %}aria-current="page"{% endif %} href="?view=inactive-applications">Inactive applications</a>
                    </li>
                </ul>
            </nav>
            {% if not activeApplicationView %}
                <h2 class="govuk-heading-l" data-qa="inactive-applications">Inactive applications</h2>
                {{ inactiveApplicationsTab({ cases: inactiveApplications }) }}
            {% else %}
                {{ caseloadTable("Your cases", ["Name", "POM", "HDCED", "Working days to HDCED", "Last worked on by", "Task"], cases)}}
            {% endif %}
        </div>
    </div>
{% endblock %}
